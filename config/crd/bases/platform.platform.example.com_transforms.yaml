---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: transforms.platform.platform.example.com
spec:
  group: platform.platform.example.com
  names:
    kind: Transform
    listKind: TransformList
    plural: transforms
    shortNames:
    - tf
    singular: transform
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.cueRef.ref
      name: CueRef
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          Transform is the Schema for the transforms API
          Transform is the single user-facing CRD for all platform types.
          Platform definitions (WebService, Database, Queue, etc.) are CUE artifacts, not separate CRDs.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: TransformSpec defines the desired state of Transform
            properties:
              adopt:
                description: Adopt specifies existing resources to adopt into management
                properties:
                  resources:
                    description: Resources lists specific resources to adopt
                    items:
                      description: AdoptedResourceRef identifies a resource to adopt
                      properties:
                        apiVersion:
                          description: APIVersion of the resource to adopt
                          type: string
                        kind:
                          description: Kind of the resource to adopt
                          type: string
                        name:
                          description: Name of the resource to adopt
                          type: string
                        namespace:
                          description: Namespace of the resource to adopt (empty for
                            cluster-scoped)
                          type: string
                      required:
                      - apiVersion
                      - kind
                      - name
                      type: object
                    type: array
                type: object
              cueRef:
                description: CueRef specifies how to locate the CUE platform module
                properties:
                  path:
                    description: |-
                      Path is the path within the CUE module to the platform definition
                      Used for git and oci types when the module contains multiple platforms
                    type: string
                  pullSecretRef:
                    description: |-
                      PullSecretRef references a Secret containing credentials for private OCI/Git
                      The secret should contain keys like "username", "password" or ".dockerconfigjson"
                    properties:
                      name:
                        description: Name of the referent
                        minLength: 1
                        type: string
                    required:
                    - name
                    type: object
                  ref:
                    description: |-
                      Ref is the reference to the CUE module
                      For oci: "ghcr.io/org/platforms/webservice:v1.0.0"
                      For git: "https://github.com/org/platforms.git?ref=v1.0.0"
                      For configmap: "my-platform-configmap"
                      For inline: the CUE code itself
                      For embedded: the platform type name (e.g., "webservice")
                    minLength: 1
                    type: string
                  type:
                    description: Type specifies the source type for the CUE module
                    enum:
                    - oci
                    - git
                    - configmap
                    - inline
                    - embedded
                    type: string
                required:
                - ref
                - type
                type: object
              input:
                description: |-
                  Input is the free-form input data for the CUE platform module
                  This will be validated against the CUE schema defined in the platform module
                type: object
                x-kubernetes-preserve-unknown-fields: true
            required:
            - cueRef
            - input
            type: object
          status:
            description: TransformStatus defines the observed state of Transform
            properties:
              conditions:
                description: |-
                  Conditions represent the current state of the Transform
                  Condition types include:
                  - "CueFetched": CUE module fetched successfully
                  - "Validated": Input validated against CUE schema
                  - "Rendered": ResourceGraph created successfully
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              observedGeneration:
                description: ObservedGeneration is the generation observed by the
                  controller
                format: int64
                type: integer
              resolvedCueRef:
                description: ResolvedCueRef contains the resolved CUE module reference
                properties:
                  digest:
                    description: |-
                      Digest is the content hash of the resolved CUE module
                      For OCI this is the manifest digest, for Git the commit SHA
                    type: string
                  fetchedAt:
                    description: FetchedAt is when the module was last fetched
                    format: date-time
                    type: string
                type: object
              resourceGraphRef:
                description: ResourceGraphRef references the ResourceGraph created
                  from this Transform
                properties:
                  apiVersion:
                    description: APIVersion of the referent
                    type: string
                  kind:
                    description: Kind of the referent
                    type: string
                  name:
                    description: Name of the referent
                    type: string
                  namespace:
                    description: Namespace of the referent (empty for cluster-scoped)
                    type: string
                  uid:
                    description: UID of the referent
                    type: string
                required:
                - apiVersion
                - kind
                - name
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}

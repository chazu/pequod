---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: transforms.platform.platform.example.com
spec:
  group: platform.platform.example.com
  names:
    kind: Transform
    listKind: TransformList
    plural: transforms
    shortNames:
    - tf
    singular: transform
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .status.generatedCRD.name
      name: CRD
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          Transform is the Schema for the transforms API.
          Transform is a platform definition that generates a CRD for developers to use.
          Platform engineers create Transforms, which generate CRDs (e.g., WebService, Database).
          Developers create instances of those CRDs, which trigger ResourceGraph creation.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: |-
              TransformSpec defines the desired state of Transform.
              Transform is a platform definition that generates a CRD for developers to use.
            properties:
              categories:
                description: Categories are optional categories for the generated
                  CRD
                items:
                  type: string
                type: array
              cueRef:
                description: CueRef specifies how to locate the CUE platform module
                properties:
                  path:
                    description: |-
                      Path is the path within the CUE module to the platform definition
                      Used for git and oci types when the module contains multiple platforms
                    type: string
                  pullSecretRef:
                    description: |-
                      PullSecretRef references a Secret containing credentials for private OCI/Git
                      The secret should contain keys like "username", "password" or ".dockerconfigjson"
                    properties:
                      name:
                        description: Name of the referent
                        minLength: 1
                        type: string
                    required:
                    - name
                    type: object
                  ref:
                    description: |-
                      Ref is the reference to the CUE module
                      For oci: "ghcr.io/org/platforms/webservice:v1.0.0"
                      For git: "https://github.com/org/platforms.git?ref=v1.0.0"
                      For configmap: "my-platform-configmap"
                      For inline: the CUE code itself
                      For embedded: the platform type name (e.g., "webservice")
                    minLength: 1
                    type: string
                  type:
                    description: Type specifies the source type for the CUE module
                    enum:
                    - oci
                    - git
                    - configmap
                    - inline
                    - embedded
                    type: string
                required:
                - ref
                - type
                type: object
              group:
                default: pequod.io
                description: |-
                  Group is the API group for the generated CRD
                  Defaults to "pequod.io"
                type: string
              managedResources:
                description: |-
                  ManagedResources declares the Kubernetes resource types that this
                  Transform's CUE template will create. Used to generate scoped RBAC.
                  If empty, the Transform will not generate any RBAC rules.
                items:
                  description: ManagedResource defines a Kubernetes resource type
                    that a Transform manages
                  properties:
                    apiGroup:
                      description: APIGroup is the API group of the resource (e.g.,
                        "apps", "" for core)
                      type: string
                    resources:
                      description: Resources is the list of resources in this API
                        group (e.g., ["deployments", "statefulsets"])
                      items:
                        type: string
                      minItems: 1
                      type: array
                  required:
                  - resources
                  type: object
                type: array
              rbacScope:
                default: Cluster
                description: |-
                  RBACScope determines whether to create cluster-wide or namespace-scoped RBAC.
                  Cluster: Creates a ClusterRole aggregated into the manager's permissions.
                  Namespace: Creates a Role and RoleBinding in the Transform's namespace.
                  Defaults to Cluster if not specified.
                enum:
                - Cluster
                - Namespace
                type: string
              shortNames:
                description: ShortNames are optional short names for the generated
                  CRD
                items:
                  type: string
                type: array
              version:
                default: v1alpha1
                description: |-
                  Version is the API version for the generated CRD
                  Defaults to "v1alpha1"
                type: string
            required:
            - cueRef
            type: object
          status:
            description: TransformStatus defines the observed state of Transform
            properties:
              conditions:
                description: |-
                  Conditions represent the current state of the Transform
                  Condition types include:
                  - "CueFetched": CUE module fetched successfully
                  - "SchemaExtracted": Input schema extracted from CUE
                  - "CRDGenerated": CRD generated and applied to cluster
                  - "RBACConfigured": RBAC resources generated and applied
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              generatedCRD:
                description: GeneratedCRD contains information about the generated
                  CRD
                properties:
                  apiVersion:
                    description: APIVersion is the API version of instances (e.g.,
                      "apps.example.com/v1alpha1")
                    type: string
                  kind:
                    description: Kind is the kind of instances (e.g., "WebService")
                    type: string
                  name:
                    description: Name is the CRD resource name (e.g., "webservices.apps.example.com")
                    type: string
                  plural:
                    description: Plural is the plural form of the kind (e.g., "webservices")
                    type: string
                required:
                - apiVersion
                - kind
                - name
                - plural
                type: object
              generatedRBAC:
                description: GeneratedRBAC contains information about the generated
                  RBAC resources
                properties:
                  clusterRoleName:
                    description: ClusterRoleName is the name of the generated ClusterRole
                      (if scope=Cluster)
                    type: string
                  roleBindingName:
                    description: RoleBindingName is the name of the generated RoleBinding
                      (if scope=Namespace)
                    type: string
                  roleName:
                    description: RoleName is the name of the generated Role (if scope=Namespace)
                    type: string
                  ruleCount:
                    description: RuleCount is the number of policy rules in the generated
                      role
                    type: integer
                required:
                - ruleCount
                type: object
              observedGeneration:
                description: ObservedGeneration is the generation observed by the
                  controller
                format: int64
                type: integer
              phase:
                description: Phase is the current phase of the Transform
                enum:
                - Pending
                - Fetching
                - Generating
                - Ready
                - Failed
                type: string
              resolvedCueRef:
                description: ResolvedCueRef contains the resolved CUE module reference
                properties:
                  digest:
                    description: |-
                      Digest is the content hash of the resolved CUE module
                      For OCI this is the manifest digest, for Git the commit SHA
                    type: string
                  fetchedAt:
                    description: FetchedAt is when the module was last fetched
                    format: date-time
                    type: string
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
